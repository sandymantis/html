
// accordion-component.js
class AccordionComponent extends HTMLElement {
  constructor() {
    super();
    this.attachShadow({ mode: 'open' });
  }

  connectedCallback() {
    this.render();
  }

  render() {
    this.shadowRoot.innerHTML = `
      <style>
        :host {
          display: block;
          font-family: system-ui, -apple-system, sans-serif;
        }

        .accordion {
          border: 1px solid #e5e7eb;
          border-radius: 4px;
          overflow: hidden;
        }
      </style>
      <div class="accordion">
        <slot></slot>
      </div>
    `;
  }
}

class AccordionItemComponent extends HTMLElement {
  constructor() {
    super();
    this.attachShadow({ mode: 'open' });
  }

  connectedCallback() {
    const title = this.getAttribute('title') || 'Accordion Item';
    const content = this.innerHTML;
    
    this.shadowRoot.innerHTML = `
      <style>
        :host {
          display: block;
          border-bottom: 1px solid #e5e7eb;
        }

        :host(:last-child) {
          border-bottom: none;
        }

        .accordion-trigger {
          width: 100%;
          padding: 1rem;
          display: flex;
          justify-content: space-between;
          align-items: center;
          background: none;
          border: none;
          cursor: pointer;
          text-align: left;
          font-size: 0.875rem;
          font-weight: 500;
          transition: background-color 0.2s;
        }

        .accordion-trigger:hover {
          text-decoration: underline;
          background-color: #f9fafb;
        }

        .chevron {
          width: 16px;
          height: 16px;
          transition: transform 0.2s;
        }

        .accordion-trigger[aria-expanded="true"] .chevron {
          transform: rotate(180deg);
        }

        .accordion-content {
          height: 0;
          overflow: hidden;
          transition: height 0.3s ease-out;
          padding: 0 1rem;
        }

        .accordion-content.expanded {
          height: auto;
          padding: 1rem;
        }

        .content-inner {
          opacity: 0;
          transition: opacity 0.3s ease-out;
        }

        .content-inner.visible {
          opacity: 1;
        }
      </style>
      <div class="accordion-item">
        <button class="accordion-trigger" aria-expanded="false">
          ${title}
          <svg class="chevron" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <polyline points="6 9 12 15 18 9"></polyline>
          </svg>
        </button>
        <div class="accordion-content">
          <div class="content-inner">
            ${content}
          </div>
        </div>
      </div>
    `;

    this.trigger = this.shadowRoot.querySelector('.accordion-trigger');
    this.content = this.shadowRoot.querySelector('.accordion-content');
    this.contentInner = this.shadowRoot.querySelector('.content-inner');
    
    this.trigger.addEventListener('click', () => this.toggleAccordion());
  }

  toggleAccordion() {
    const isExpanded = this.trigger.getAttribute('aria-expanded') === 'true';
    this.trigger.setAttribute('aria-expanded', !isExpanded);
    
    if (!isExpanded) {
      // Expanding
      this.content.classList.add('expanded');
      this.contentInner.classList.add('visible');
      // Set actual height
      const height = this.contentInner.offsetHeight;
      this.content.style.height = height + 'px';
    } else {
      // Collapsing
      const height = this.content.offsetHeight;
      this.content.style.height = height + 'px';
      // Force reflow
      this.content.offsetHeight;
      this.content.style.height = '0';
      this.contentInner.classList.remove('visible');
      
      // Remove expanded class after transition
      this.content.addEventListener('transitionend', () => {
        if (!isExpanded) return;
        this.content.classList.remove('expanded');
      }, { once: true });
    }
  }
}

// Register the components
customElements.define('custom-accordion', AccordionComponent);
customElements.define('accordion-item', AccordionItemComponent);
